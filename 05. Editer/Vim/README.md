# Vim 文字編輯器使用指南

## 簡介

Vim（Vi Improved）是 Vi 編輯器的增強版本，是一個功能強大的文字編輯器。Vim 採用模式編輯的概念，不同的模式有不同的功能，這使得它能夠高效地進行文字編輯。

## 安裝

```bash
# Debian/Ubuntu 系列
sudo apt install vim

# 安裝完整版本（包含 GUI）
sudo apt install vim-gtk

# 檢查版本
vim --version
```

## Vim 的模式

Vim 有多種模式，理解這些模式是掌握 Vim 的關鍵：

### 1. 一般模式 (Normal Mode)

這是 Vim 的預設模式，用於導航和執行命令。

**進入方式：**
- 啟動 Vim 時預設進入
- 在任何模式下按 `Esc` 回到一般模式

**用途：**
- 移動游標
- 刪除、複製、貼上文字
- 執行編輯命令

### 2. 插入模式 (Insert Mode)

用於輸入和編輯文字。

**進入方式：**
- `i`：在游標前插入
- `a`：在游標後插入
- `o`：在下一行插入
- `O`：在上一行插入
- `I`：在行首插入
- `A`：在行尾插入

**退出方式：**
- `Esc`：回到一般模式

### 3. 命令模式 (Command Mode)

用於執行檔案操作和設定命令。

**進入方式：**
- 在一般模式下按 `:`

**常用命令：**
- `:w`：儲存檔案
- `:q`：退出
- `:wq`：儲存並退出
- `:q!`：強制退出（不儲存）

### 4. 視覺模式 (Visual Mode)

用於選擇文字。

**進入方式：**
- `v`：字元視覺模式
- `V`：行視覺模式
- `Ctrl + v`：區塊視覺模式

**退出方式：**
- `Esc`：回到一般模式

### 5. 取代模式 (Replace Mode)

用於直接取代文字。

**進入方式：**
- `R`：進入取代模式
- `r`：取代單一字元

## 基本操作

### 啟動與退出

```bash
# 開啟檔案
vim filename.txt

# 開啟檔案並跳到指定行
vim +10 filename.txt

# 開啟檔案並跳到第一個匹配
vim +/pattern filename.txt

# 以唯讀模式開啟
vim -R filename.txt
vim -M filename.txt  # 強制唯讀

# 退出（在命令模式下）
:q          # 退出（無變更時）
:q!         # 強制退出（不儲存變更）
:wq         # 儲存並退出
:x          # 儲存並退出（同 :wq）
ZZ          # 儲存並退出（一般模式下）
ZQ          # 不儲存退出（一般模式下）
```

### 游標移動（一般模式）

#### 基本移動

```
h           # 向左移動一個字元
l           # 向右移動一個字元
j           # 向下移動一行
k           # 向上移動一行

方向鍵      # 也可以使用方向鍵（但不建議，因為手不需要離開主鍵盤區）
```

#### 單字移動

```
w           # 移到下一個單字開頭
W           # 移到下一個單字開頭（忽略標點）
e           # 移到目前單字結尾
E           # 移到目前單字結尾（忽略標點）
b           # 移到上一個單字開頭
B           # 移到上一個單字開頭（忽略標點）
```

#### 行內移動

```
0           # 移到行首（第一個字元）
^           # 移到行首（第一個非空白字元）
$           # 移到行尾
g_          # 移到行尾（最後一個非空白字元）
```

#### 行間移動

```
gg          # 移到檔案開頭
G           # 移到檔案結尾
nG          # 移到第 n 行（例如：10G）
:n          # 跳到第 n 行（命令模式）
```

#### 頁面移動

```
Ctrl + f    # 向下翻頁（Forward）
Ctrl + b    # 向上翻頁（Backward）
Ctrl + d    # 向下翻半頁（Down）
Ctrl + u    # 向上翻半頁（Up）
H           # 移到畫面頂部（High）
M           # 移到畫面中間（Middle）
L           # 移到畫面底部（Low）
```

#### 搜尋移動

```
/pattern    # 向下搜尋
?pattern    # 向上搜尋
n           # 下一個匹配
N           # 上一個匹配
*           # 搜尋游標下的單字（向下）
#           # 搜尋游標下的單字（向上）
```

#### 跳轉

```
%           # 跳轉到對應的括號（()、[]、{}）
(           # 移到上一個句子開頭
)           # 移到下一個句子開頭
{           # 移到上一個段落開頭
}           # 移到下一個段落開頭
```

### 文字編輯

#### 插入文字

```
i           # 在游標前插入
a           # 在游標後插入
I           # 在行首插入
A           # 在行尾插入
o           # 在下一行插入新行
O           # 在上一行插入新行
```

#### 刪除文字

```
x           # 刪除游標下的字元
X           # 刪除游標前的字元
dw          # 刪除到單字結尾
de          # 刪除到單字結尾（包含空格）
d$          # 刪除到行尾
d0          # 刪除到行首
dd          # 刪除整行
D           # 刪除到行尾（同 d$）
```

**刪除命令格式：**
- `d + 移動命令`：刪除從游標到移動目標的文字
- 例如：`d}` 刪除到段落結尾

#### 複製與貼上

```
yy          # 複製整行（Yank）
yw          # 複製單字
y$          # 複製到行尾
y0          # 複製到行首
p           # 在游標後貼上（Paste）
P           # 在游標前貼上
```

**複製命令格式：**
- `y + 移動命令`：複製從游標到移動目標的文字

#### 剪下

在 Vim 中，刪除操作同時也是剪下操作，刪除的文字會存入暫存區。

```
dd          # 剪下整行
dw          # 剪下單字
d$          # 剪下到行尾
```

#### 取代

```
r           # 取代單一字元
R           # 進入取代模式（連續取代）
s           # 取代游標下的字元並進入插入模式
S           # 取代整行並進入插入模式
cw          # 取代單字（Change Word）
c$          # 取代到行尾
cc          # 取代整行
```

**取代命令格式：**
- `c + 移動命令`：取代從游標到移動目標的文字

#### 撤銷與重做

```
u           # 撤銷上一個操作（Undo）
Ctrl + r    # 重做（Redo）
U           # 撤銷對整行的所有變更
.           # 重複上一個操作
```

### 視覺模式操作

```
v           # 進入字元視覺模式
V           # 進入行視覺模式
Ctrl + v    # 進入區塊視覺模式

# 在視覺模式下
y           # 複製選取的文字
d           # 刪除選取的文字
c           # 取代選取的文字
>           # 向右縮排
<           # 向左縮排
```

### 搜尋與取代

#### 搜尋

```
/pattern    # 向下搜尋
?pattern    # 向上搜尋
n           # 下一個匹配
N           # 上一個匹配
*           # 搜尋游標下的單字（向下）
#           # 搜尋游標下的單字（向上）

# 搜尋選項
/pattern\c  # 忽略大小寫搜尋
/pattern\C  # 區分大小寫搜尋
```

#### 取代（命令模式）

```
:s/old/new/            # 取代目前行的第一個匹配
:s/old/new/g           # 取代目前行的所有匹配
:%s/old/new/g          # 取代整個檔案的所有匹配
:%s/old/new/gc         # 取代整個檔案（每次確認）
:5,10s/old/new/g       # 取代第 5 到 10 行的匹配
:'<,'>s/old/new/g      # 取代選取範圍的匹配（視覺模式後）
```

**取代選項：**
- `g`：取代行內所有匹配
- `c`：每次取代前確認
- `i`：忽略大小寫

### 檔案操作

```
:w          # 儲存檔案
:w filename # 另存為
:wq         # 儲存並退出
:x          # 儲存並退出
:q          # 退出（無變更時）
:q!         # 強制退出（不儲存）
:e filename # 開啟檔案
:e!         # 重新載入檔案（放棄變更）
:r filename # 讀取檔案內容插入游標位置
:r !command # 讀取命令輸出插入游標位置
```

### 多檔案編輯

```
:sp filename    # 水平分割視窗開啟檔案
:vsp filename   # 垂直分割視窗開啟檔案
:new filename   # 在新視窗開啟檔案

# 視窗切換
Ctrl + w + w    # 切換視窗
Ctrl + w + h    # 切換到左邊視窗
Ctrl + w + j    # 切換到下面視窗
Ctrl + w + k    # 切換到上面視窗
Ctrl + w + l    # 切換到右邊視窗

# 視窗大小
Ctrl + w + +    # 增加視窗高度
Ctrl + w + -    # 減少視窗高度
Ctrl + w + >    # 增加視窗寬度
Ctrl + w + <    # 減少視窗寬度
```

### 標籤頁

```
:tabnew filename    # 在新標籤頁開啟檔案
:tabclose           # 關閉目前標籤頁
:tabonly            # 只保留目前標籤頁
gt                  # 下一個標籤頁
gT                  # 上一個標籤頁
ngt                 # 跳到第 n 個標籤頁
```

## 進階功能

### 宏錄製

```
qa          # 開始錄製宏到暫存區 a
...         # 執行操作
q           # 停止錄製
@a          # 執行宏 a
@@          # 重複執行上一個宏
n@a         # 執行宏 a 共 n 次
```

### 標記

```
ma          # 在游標位置設定標記 a
'a          # 跳到標記 a
`a          # 跳到標記 a 的精確位置
:marks      # 列出所有標記
```

**特殊標記：**
- `` ` ``：上次跳轉的位置
- `'`：上次跳轉的行
- `[`：上次修改的開始
- `]`：上次修改的結尾

### 暫存區

Vim 有多個暫存區（寄存器）：

```
"ayy        # 複製到暫存區 a
"ap         # 從暫存區 a 貼上
:reg        # 顯示所有暫存區內容
```

**特殊暫存區：**
- `"`：未命名暫存區（預設）
- `0`：最後一次 yank 的內容
- `1-9`：刪除歷史
- `+`：系統剪貼簿
- `*`：選擇暫存區

### 命令重複

```
.           # 重複上一個操作
n.          # 重複上一個操作 n 次
@:          # 重複上一個命令
```

### 縮排

```
>>          # 向右縮排一行
<<          # 向左縮排一行
>}          # 向右縮排到段落結尾
n>>         # 向右縮排 n 行
=           # 自動縮排
gg=G        # 自動縮排整個檔案
```

## 設定與自訂

### 設定檔位置

- 系統設定檔：`/etc/vim/vimrc`
- 使用者設定檔：`~/.vimrc`

### 常用設定範例

編輯 `~/.vimrc`：

```vim
" 基本設定
set number              " 顯示行號
set relativenumber      " 顯示相對行號
set showmode            " 顯示目前模式
set showcmd             " 顯示部分命令
set wildmenu            " 命令列自動完成

" 搜尋設定
set hlsearch            " 高亮搜尋結果
set incsearch           " 即時搜尋
set ignorecase          " 忽略大小寫
set smartcase           " 智慧大小寫

" 縮排設定
set autoindent          " 自動縮排
set smartindent         " 智慧縮排
set tabstop=4           " Tab 寬度
set shiftwidth=4        " 自動縮排寬度
set expandtab           " 使用空格代替 Tab

" 其他設定
set backup              " 建立備份檔案
set backupdir=~/.vim/backup
set directory=~/.vim/swap
set undofile            " 啟用撤銷歷史
set undodir=~/.vim/undo
set mouse=a             " 啟用滑鼠支援
syntax on               " 啟用語法高亮
filetype on             " 啟用檔案類型偵測
filetype plugin on      " 啟用檔案類型插件
filetype indent on      " 啟用檔案類型縮排

" 快捷鍵映射
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l
```

### 插件管理

使用插件管理器（如 vim-plug）：

```vim
" 在 ~/.vimrc 中加入
call plug#begin('~/.vim/plugged')
Plug 'tpope/vim-surround'
Plug 'scrooloose/nerdtree'
call plug#end()
```

## 快捷鍵完整參考

### 一般模式

#### 游標移動

| 命令 | 功能 |
|------|------|
| h, j, k, l | 左、下、上、右 |
| w, W | 下一個單字開頭 |
| e, E | 單字結尾 |
| b, B | 上一個單字開頭 |
| 0, ^ | 行首 |
| $ | 行尾 |
| gg | 檔案開頭 |
| G | 檔案結尾 |
| nG | 第 n 行 |
| H, M, L | 畫面頂、中、底 |
| Ctrl + f, b | 翻頁 |
| /pattern | 搜尋 |
| n, N | 下一個、上一個匹配 |

#### 編輯操作

| 命令 | 功能 |
|------|------|
| i, a | 插入模式 |
| I, A | 行首、行尾插入 |
| o, O | 新行插入 |
| x | 刪除字元 |
| dd | 刪除行 |
| dw | 刪除單字 |
| yy | 複製行 |
| p, P | 貼上 |
| u | 撤銷 |
| Ctrl + r | 重做 |
| . | 重複操作 |

### 命令模式

| 命令 | 功能 |
|------|------|
| :w | 儲存 |
| :q | 退出 |
| :wq | 儲存並退出 |
| :q! | 強制退出 |
| :s/old/new/g | 取代 |
| :%s/old/new/g | 全域取代 |
| :sp file | 水平分割 |
| :vsp file | 垂直分割 |

## 學習路徑建議

1. **第一階段**：掌握基本模式切換（i, Esc, :wq）
2. **第二階段**：學習游標移動（h, j, k, l, w, b, $, ^）
3. **第三階段**：學習編輯操作（dd, yy, p, u）
4. **第四階段**：學習搜尋與取代（/, :s）
5. **第五階段**：學習進階功能（視覺模式、宏、標記）

## 實用技巧

### 快速編輯

```
ci"         # 修改引號內的內容（Change Inside Quotes）
ci(         # 修改括號內的內容
di"         # 刪除引號內的內容
da"         # 刪除引號及內容
```

### 文字物件

```
iw          # 內單字（Inner Word）
aw          # 單字及空格（A Word）
i"          # 引號內
a"          # 引號及內容
i(          # 括號內
a(          # 括號及內容
```

### 組合命令

```
daw         # 刪除單字（Delete A Word）
ciw         # 取代單字（Change Inner Word）
yap         # 複製段落（Yank A Paragraph）
```

## 常見問題

### 如何退出 Vim？

按 `Esc` 確保在一般模式，然後輸入 `:q!` 強制退出，或 `:wq` 儲存後退出。

### 如何顯示行號？

在命令模式下輸入 `:set number`，或在 `~/.vimrc` 中加入 `set number`。

### 如何搜尋並取代？

使用 `:%s/old/new/g` 取代整個檔案的所有匹配。

### 如何複製多行？

1. 按 `V` 進入行視覺模式
2. 移動游標選擇行
3. 按 `y` 複製
4. 移動到目標位置
5. 按 `p` 貼上

## 參考資源

- Vim 內建教學：在終端輸入 `vimtutor`
- 官方文件：`:help` 在 Vim 中查看
- 線上資源：Vim 官方網站和社群文件